<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechEdu - Computer Courses</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <meta name="theme-color" content="#2c3e50">
    <link rel="preconnect" href="https://fonts.googleapis.com">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="logo">
            <div>Львівський центр професійно-технічної освіти</div>
            <div>Державної служби зайнятості</div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Опануйте Сучасні Технології</h1>
            <p class="subtitle">Змініть свою кар'єру з нашими професійними курсами</p>
            <a href="#courses" class="cta-button">
                <i class="material-icons">school</i>
                Почати навчання
            </a>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products" id="courses">
        <div class="courses-container">
            <div class="product-grid">
                <div class="product-card" data-course-id="comp-processing">
                    <img src="https://cdn-dynmedia-1.microsoft.com/is/image/microsoftcorp/Highlight-Microsoft-365-Icon-Toss-Cycle-2:VP2-859x540" alt="Комп'ютерна обробка">
                    <div class="product-info">
                        <h3>Технології комп'ютерної обробки інформації</h3>
                        <p>Опануйте сучасні технології обробки та аналізу інформації</p>
                        <p class="course-details">
                            Тривалість: 2 тижні<br>
                            Рівень: Початківець-Середній<br>
                            Графік: Гнучке навчання
                        </p>
                        <div class="product-actions">
                            <button class="add-to-cart">
                                <i class="material-icons">school</i>
                                Почати навчання
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="product-card" data-course-id="cybersec-osint">
                    <img src="https://nirmawebsite.s3.ap-south-1.amazonaws.com/wp-content/uploads/2024/08/cyber-security-background-meuqfzxcg4gdd26s-1024x576.jpg" alt="Цифрова безпека">
                    <div class="product-info">
                        <h3>Основи цифрової безпеки та OSINT</h3>
                        <p>Вивчіть основи кібербезпеки та методи розвідки відкритих джерел</p>
                        <p class="course-details">
                            Тривалість: 2 тижні<br>
                            Рівень: Середній<br>
                            Графік: Живі сесії + Самостійно
                        </p>
                        <div class="product-actions">
                            <button class="add-to-cart">
                                <i class="material-icons">school</i>
                                Почати навчання
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-course-id="google-cloud">
                    <img src="https://edublog.com.ua/system/posts/images/000/000/112/show/5bbb88e1399a4.jpg?1621844163" alt="Google Cloud">
                    <div class="product-info">
                        <h3>Хмарні сервіси GOOGLE</h3>
                        <p>Ефективно використовуйте хмарні технології Google</p>
                        <p class="course-details">
                            Тривалість: 2 тижні<br>
                            Рівень: Початківець<br>
                            Графік: Гнучке навчання
                        </p>
                        <div class="product-actions">
                            <button class="add-to-cart">
                                <i class="material-icons">school</i>
                                Почати навчання
                            </button>
                        </div>
                    </div>
                </div>

                <div class="product-card" data-course-id="web-design">
                    <img src="./images/upscalemedia-transformed.png" alt="Web Design">
                    <div class="product-info">
                        <h3>Основи веб дизайну</h3>
                        <p>Створюйте сучасні та привабливі веб-сайти</p>
                        <p class="course-details">
                            Тривалість: 2 тижні<br>
                            Рівень: Початківець<br>
                            Графік: Гнучке навчання
                        </p>
                        <div class="product-actions">
                            <button class="add-to-cart">
                                <i class="material-icons">school</i>
                                Почати навчання
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="course-expanded">
        <button class="back-button">
            <i class="material-icons">arrow_back</i>
        </button>
        <div class="expanded-content">
            <img src="" alt="Course Image" id="expanded-image">
            <h2 id="expanded-title"></h2>
            <p id="expanded-description"></p>
            <div class="course-details" id="expanded-details"></div>
            <div class="course-full-description">
                <h3>Про курс</h3>
                <p id="expanded-full-description"></p>
            </div>
            <div class="course-modules">
                <h3>Модулі курсу</h3>
                <div id="expanded-modules"></div>
            </div>
            <button class="add-to-cart">
                <i class="material-icons">school</i>
                Почати навчання
            </button>
        </div>
    </div>

    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="contact-info">
            <h2>Реєстрація на курс</h2>
            <form class="contact-form" id="courseForm">
                <input type="text" name="name" placeholder="Ім'я" required>
                <input type="email" name="email" placeholder="Email" required>
                <select name="course" id="courseSelect" required>
                    <option value="">Оберіть курс</option>
                    <option value="comp-processing">Технології комп'ютерної обробки інформації</option>
                    <option value="cybersec-osint">Основи цифрової безпеки та OSINT</option>
                    <option value="google-cloud">Хмарні сервіси GOOGLE</option>
                    <option value="web-design">Основи веб дизайну</option>
                </select>
                <textarea name="message" rows="5" placeholder="Повідомлення" required></textarea>
                <button type="submit">
                    <span class="loading-indicator" style="display: none;"></span>
                    <span class="button-text">Зареєструватися</span>
                </button>
            </form>
            <div class="contact-methods">
                <div class="contact-method">
                    <a href="https://www.google.com/maps/search/?api=1&query=Львів+вулиця+Княгині+Ольги+122" target="_blank" class="contact-link">
                        <i class="material-icons">location_on</i>
                        <span>79060, м. Львів, вул. Княгині Ольги, буд. 122</span>
                    </a>
                </div>
                <div class="contact-method">
                    <a href="tel:+380322322262" class="contact-link">
                        <i class="material-icons">phone</i>
                        <span>
                            (032) 232-22-62<br>
                            Методисти: (032) 244-13-30<br>
                            (067) 672-08-52
                        </span>
                    </a>
                </div>
                <div class="contact-method">
                    <i class="fas fa-clock"></i>
                    <span>Графік роботи: пн-пт 9:00-18:00</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2023 ТехОсвіта. Всі права захищені.</p>
    </footer>

    <div class="chat-widget">
        <button class="chat-button" id="chatButton">
            <i class="material-icons">chat</i>
        </button>
        
        <div class="chat-modal" id="chatModal">
            <div class="chat-header">
                Чат підтримки
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message system">
                    Вітаю! Будь ласка, представтесь.
                </div>
            </div>
            <div class="name-input-container active" id="nameInputContainer">
                <form class="chat-form" id="nameForm">
                    <input type="text" id="userName" placeholder="Ваше ім'я" required>
                    <button type="submit">Продовжити</button>
                </form>
            </div>
            <div class="chat-input hidden" id="messageInput">
                <form class="chat-form" id="chatForm">
                    <textarea id="userMessage" placeholder="Ваше повідомлення" required></textarea>
                    <button type="submit">Надіслати</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Remove old menu toggle code since we don't have a menu anymore
            
            // Add header scroll effect
            const header = document.querySelector('header');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });

            // Form submission feedback
            const form = document.querySelector('.contact-form');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const button = form.querySelector('button');
                const loadingIndicator = button.querySelector('.loading-indicator');
                const buttonText = button.querySelector('.button-text');

                loadingIndicator.style.display = 'inline-block';
                buttonText.textContent = 'Надсилання...';
                button.disabled = true;

                const formData = {
                    name: form.querySelector('[name="name"]').value,
                    email: form.querySelector('[name="email"]').value,
                    course: form.querySelector('[name="course"]').value,
                    message: form.querySelector('[name="message"]').value
                };

                try {
                    const response = await fetch('https://script.google.com/macros/s/AKfycbzkC17GsacCLAXdvaEEBrfa6DfCuocuhubnIcXvSeavLnA7DDUI0nVlMFAlAW9Sgl7d/exec', {
                        method: 'POST',
                        body: JSON.stringify(formData),
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        mode: 'no-cors' // Add this line
                    });

                    // Since 'no-cors' doesn't return JSON, modify the success check
                    if (response.type === 'opaque') {
                        buttonText.textContent = 'Надіслано!';
                        form.reset();
                        setTimeout(() => {
                            buttonText.textContent = 'Зареєструватися';
                            loadingIndicator.style.display = 'none';
                            button.disabled = false;
                        }, 2000);
                    } else {
                        throw new Error('Failed to submit');
                    }
                } catch (error) {
                    buttonText.textContent = 'Помилка';
                    loadingIndicator.style.display = 'none';
                    button.disabled = false;
                    console.error('Form submission error:', error);
                }
            });

            // Course details data
            const courseDetails = {
                'comp-processing': {
                    title: 'Технології комп\'ютерної обробки інформації',
                    fullDescription: 'Комплексний курс з обробки інформації, включаючи роботу з документами, таблицями, презентаціями та базами даних. Навчіться ефективно використовувати сучасне програмне забезпечення.',
                    modules: [
                        'Основи комп\'ютерної грамотності',
                        'Робота з текстовими редакторами',
                        'Електронні таблиці та аналіз даних',
                        'Створення презентацій',
                        'Основи баз даних',
                        'Інформаційна безпека'
                    ]
                },
                'cybersec-osint': {
                    title: 'Основи цифрової безпеки та OSINT',
                    fullDescription: 'Курс з основ кібербезпеки та методів розвідки відкритих джерел (OSINT). Вивчіть методи захисту інформації та техніки пошуку даних.',
                    modules: [
                        'Основи інформаційної безпеки',
                        'Захист персональних даних',
                        'Методологія OSINT',
                        'Інструменти розвідки',
                        'Аналіз соціальних мереж',
                        'Захист від кіберзагроз'
                    ]
                },
                'google-cloud': {
                    title: 'Хмарні сервіси GOOGLE',
                    fullDescription: 'Практичний курс з використання хмарних сервісів Google. Навчіться ефективно використовувати Google Workspace та інші хмарні інструменти.',
                    modules: [
                        'Google Docs та спільна робота',
                        'Google Sheets та аналітика',
                        'Google Slides та презентації',
                        'Google Forms та опитування',
                        'Google Drive та хмарне сховище',
                        'Google Meet та відеоконференції'
                    ]
                },
                'web-design': {
                    title: 'Основи веб дизайну',
                    fullDescription: 'Базовий курс з веб-дизайну. Вивчіть принципи створення привабливих та функціональних веб-сайтів.',
                    modules: [
                        'Основи HTML та CSS',
                        'Принципи дизайну',
                        'Типографіка та кольори',
                        'Адаптивний дизайн',
                        'Оптимізація графіки',
                        'Основи юзабіліті'
                    ]
                }
            };

            // Update card click handlers
            const productCards = document.querySelectorAll('.product-card');
            const expandedView = document.querySelector('.course-expanded');
            const backButton = document.querySelector('.back-button');

            productCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    // Don't trigger if clicking the action button
                    if (e.target.closest('.add-to-cart')) {
                        return;
                    }
                    
                    const courseId = card.dataset.courseId;
                    const details = courseDetails[courseId];
                    
                    if (!details) return; // Guard against missing data
                    
                    document.getElementById('expanded-image').src = card.querySelector('img').src;
                    document.getElementById('expanded-title').textContent = card.querySelector('h3').textContent;
                    document.getElementById('expanded-description').textContent = card.querySelector('p').textContent;
                    document.getElementById('expanded-details').innerHTML = card.querySelector('.course-details').innerHTML;
                    document.getElementById('expanded-full-description').textContent = details.fullDescription;
                    
                    const modulesList = details.modules.map(module => 
                        `<div class="module-item">${module}</div>`
                    ).join('');
                    document.getElementById('expanded-modules').innerHTML = modulesList;
                    
                    expandedView.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });

                // Add keyboard navigation
                card.setAttribute('tabindex', '0');
                card.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        card.click();
                    }
                });
            });

            // Ensure back button works
            backButton.addEventListener('click', () => {
                expandedView.classList.remove('active');
                document.body.style.overflow = 'auto';
            });

            // Add escape key handler for expanded view
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && expandedView.classList.contains('active')) {
                    expandedView.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });

            // Add click handlers for course buttons
            const courseButtons = document.querySelectorAll('.course-button');
            courseButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const courseId = button.dataset.courseId;
                    const card = document.querySelector(`.product-card[data-course-id="${courseId}"]`);
                    if (card) {
                        card.click();
                    }
                });
            });

            // Add click handlers for "Почати навчання" buttons
            const startButtons = document.querySelectorAll('.add-to-cart');
            startButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent card expansion when clicking button
                    const courseCard = button.closest('.product-card');
                    const courseId = courseCard ? courseCard.dataset.courseId : null;
                    const courseSelect = document.getElementById('courseSelect');
                    
                    if (courseId) {
                        courseSelect.value = courseId;
                    }
                    
                    // Close expanded view if open
                    expandedView.classList.remove('active');
                    document.body.style.overflow = 'auto';
                    
                    // Scroll to contact form
                    document.getElementById('contact').scrollIntoView({ 
                        behavior: 'smooth'
                    });
                });
            });

            // Add keyboard navigation for course cards
            document.querySelectorAll('.product-card').forEach(card => {
                card.setAttribute('tabindex', '0');
                card.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        card.click();
                    }
                });
            });

            // Chat functionality
            const chatButton = document.getElementById('chatButton');
            const chatModal = document.getElementById('chatModal');
            const nameForm = document.getElementById('nameForm');
            const chatForm = document.getElementById('chatForm');
            const nameInputContainer = document.getElementById('nameInputContainer');
            const messageInput = document.getElementById('messageInput');
            const chatMessages = document.getElementById('chatMessages');
            const TELEGRAM_BOT_TOKEN = '7512696267:AAHsMkXmwxi5G8HHOKELvX_cbYt3VNnX5DQ';
            const TELEGRAM_CHAT_ID = '1661102857';
            const INACTIVITY_TIMEOUT = 60000; // 1 minute in milliseconds
            const CHAT_CLOSE_DELAY = 1500;    // 1.5 seconds before closing chat
            let inactivityTimer;
            let isFirstTimeout = true;
            let lastUpdateId = 0;
            const processedMessageIds = new Set();

            // Show chat modal automatically
            setTimeout(() => {
                chatModal.classList.add('active');
            }, 1000);

            // Chat button toggle
            chatButton.addEventListener('click', () => {
                chatModal.classList.toggle('active');
            });

            // Name submission
            nameForm.addEventListener('submit', (e) => {
                e.preventDefault();
                userName = document.getElementById('userName').value.trim();
                
                if (userName) {
                    nameInputContainer.classList.remove('active');
                    messageInput.classList.remove('hidden');
                    messageInput.classList.add('visible');
                    appendMessage('system', `Дякуємо, ${userName}! Тепер ви можете поставити своє запитання.`);
                    startInactivityTimer();
                }
            });

            // Message submission
            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const messageText = document.getElementById('userMessage').value.trim();
                
                if (!messageText) return;

                // Reset inactivity timer
                isFirstTimeout = true;
                startInactivityTimer();

                // Add user message to chat
                appendMessage('user', messageText);
                
                try {
                    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            chat_id: TELEGRAM_CHAT_ID,
                            text: `Повідомлення від: ${userName}\n${messageText}`
                        })
                    });
                    
                    if (response.ok) {
                        document.getElementById('userMessage').value = '';
                    } else {
                        throw new Error('Network response was not ok');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    appendMessage('system', 'Виникла помилка. Спробуйте надіслати повідомлення ще раз.');
                }
            });

            // Ctrl+Enter handling
            document.getElementById('userMessage').addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    chatForm.dispatchEvent(new Event('submit'));
                }
            });

            // Set placeholder with Ctrl+Enter hint
            document.getElementById('userMessage').placeholder = 'Ваше повідомлення (Ctrl+Enter для надсилання)';

            // Chat utilities
            function startInactivityTimer() {
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    if (isFirstTimeout) {
                        appendMessage('system', 'У вас є ще запитання до нас?');
                        isFirstTimeout = false;
                        startInactivityTimer(); // Start second timer
                    } else {
                        appendMessage('system', 'Дякуємо за увагу, до побачення!');
                        setTimeout(() => {
                            chatModal.classList.remove('active');
                        }, CHAT_CLOSE_DELAY);
                    }
                }, INACTIVITY_TIMEOUT);
            }

            function appendMessage(type, text) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.textContent = text;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Check for new messages
            async function checkNewMessages() {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates?offset=${lastUpdateId}`);
                    const data = await response.json();
                    
                    if (data.ok && data.result.length > 0) {
                        data.result.forEach(update => {
                            if (!processedMessageIds.has(update.update_id)) {
                                const message = update.message;
                                if (message && message.chat.id.toString() === TELEGRAM_CHAT_ID && message.from.id.toString() === TELEGRAM_CHAT_ID) {
                                    appendMessage('admin', message.text);
                                }
                                processedMessageIds.add(update.update_id);
                                lastUpdateId = update.update_id + 1;
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error checking messages:', error);
                }
            }

            // Start message polling
            setInterval(checkNewMessages, 1000);
        });
    </script>
</body>
</html>
